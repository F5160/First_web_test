<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
      position: relative;
      opacity: 0; /* 初始状态下隐藏页面内容 */
      transition: opacity 0.2s ease-in-out; /* 添加过渡效果 */
    }

    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #overlay {
      z-index: 1;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgb(200, 200, 255);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 400ms ease-out;
    }
    #buttonOne {
      z-index: 1;
      width: 100%;
      height: 100%;
      background-color: transparent;
      border: none;
      cursor: pointer;
    }
    #audioControl {
      z-index: 0;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: opacity 0.5s ease;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }
    #audioControl.paused {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <!-- 加载界面 -->
  <div id="loading-screen" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  ">
    <div class="loader"></div>
    <p>加载中...</p>
  </div>
  <!-- 页面内容（默认隐藏） -->
  <div id="main-content" style="display: none;">
    <div id="overlay">
      <button id="buttonOne">Click to start</button>
    </div>
    <button id="audioControl">暂停</button>
    <audio id="backgroundAudio" loop>
      <source src="File/audio/arcaea.mp3" type="audio/mpeg">
      您的浏览器不支持 audio 元素。
    </audio>
  </div>

  <script>
    window.addEventListener('load', function() {
      // 确保页面 DOM 和所有资源（图片、音频等）加载完毕
      const loadingScreen = document.getElementById('loading-screen');
      const mainContent = document.getElementById('main-content');
      const audio = document.getElementById('backgroundAudio');
      const controlButton = document.getElementById('audioControl');
      const overlay = document.getElementById('overlay');
      const buttonOne = document.getElementById('buttonOne');

      // 设置初始音量为0
      audio.volume = 0;

      // 定义淡入淡出函数
      function fadeAudio(toVolume, duration) {
        let startVolume = audio.volume;
        let change = toVolume - startVolume;
        let startTime = Date.now();
        let fadeInterval = setInterval(() => {
          let currentTime = Date.now();
          let timeElapsed = currentTime - startTime;
          let newVolume = startVolume + (change * (timeElapsed / duration));
          if (timeElapsed > duration) {
            newVolume = toVolume;
            clearInterval(fadeInterval);
          }
          audio.volume = newVolume;
        }, 10);
      }

      // 音频加载完成后的处理
      audio.addEventListener('canplaythrough', function() {
        console.log('Audio can play through'); // 调试信息
        // 隐藏加载界面，显示内容
        loadingScreen.style.display = 'none';
        mainContent.style.display = 'block';
        // 确保所有资源加载完毕后再显示页面
        document.body.style.opacity = 1; // 显示页面内容
      });

      // 如果音频加载失败，超时处理
      setTimeout(() => {
        console.error('Audio failed to load within 10 seconds');
        loadingScreen.style.display = 'none';
        mainContent.style.display = 'block';
        document.body.style.opacity = 1; // 显示页面内容
      }, 10000); // 10 秒超时

      // 音频错误处理
      audio.addEventListener('error', (event) => {
        console.error('Audio error:', event); // 调试信息
        loadingScreen.style.display = 'none';
        mainContent.style.display = 'block';
        document.body.style.opacity = 1; // 显示页面内容
      });

      // 控制按钮点击事件
      controlButton.addEventListener('click', () => {
        if (audio.paused) {
          audio.play().then(() => {
            fadeAudio(1, 1000); // 淡入1秒
          }).catch(error => {
            console.error('播放被阻止:', error);
          });
          controlButton.textContent = '暂停';
          controlButton.classList.remove('paused');
        } else {
          fadeAudio(0, 1000); // 淡出1秒
          setTimeout(() => {
            audio.pause();
          }, 1000);
          controlButton.textContent = '继续';
          controlButton.classList.add('paused');
        }
      });

      // 播放事件处理
      audio.addEventListener('play', () => {
        controlButton.classList.remove('paused');
      });

      // 暂停事件处理
      audio.addEventListener('pause', () => {
        controlButton.classList.add('paused');
      });

      // 按钮一点击事件
      buttonOne.addEventListener('click', () => {
        console.log('buttonOne clicked'); // 调试信息
        audio.play().then(() => {
          console.log('Audio played successfully'); // 调试信息
          audio.volume = 1; // 立即设置音量为1
        }).catch(error => {
          console.error('播放被阻止:', error);
        });
        setTimeout(() => {
          overlay.style.transform = 'translateY(-100%)';
          setTimeout(() => {
            overlay.remove();
            buttonOne.remove();
          }, 1000); // 与CSS的transition时间一致
        }, 200);
      });
    });
  </script>
</body>
</html>